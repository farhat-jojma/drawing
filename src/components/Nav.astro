---
import type { GetStaticPaths } from "astro";
const { siteName = "Pixel Drawing Online" } = Astro.props;
import { getLangStaticPaths, resolveLang } from "../lib/i18n";

export async function getStaticPaths() {
  return getLangStaticPaths();
}

const locale = resolveLang(Astro.params.lang);
const dict = await import(`../locales/${locale}.json`).then((m) => m.default);
const navDict = dict?.nav || {};
---

<nav class="w-full fixed top-0 left-0 z-50 pixel-nav flex items-center justify-between text-[#2b2b2b] px-4 py-3" lang={locale}>
  <!-- Pixel logo/title -->
  <a href={`/${locale}/`} class="flex items-center gap-3 group" aria-label={dict.siteName}>
    <span class="logo-wrap">
      <img class="logo-img" src="/favicon.png" alt={dict.siteName} width="28" height="28" />
    </span>
    <span class="text-xl font-black pixel-font group-hover:drop-shadow-pixel">{dict.siteName}</span>
  </a>

  <!-- Pixel hamburger -->
  <button id="hamburger-btn" 
          class="pixel-button focus:outline-none"
          aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-dropdown">
    <span class="pixel-bars" aria-hidden="true"></span>
  </button>
  
  <!-- Pixel dropdown -->
  <ul id="nav-dropdown" 
      class="hidden absolute top-full right-4 mt-3 pixel-card w-60 text-sm transform opacity-0 scale-95 transition-all duration-200 ease-out"
      role="menu" aria-labelledby="hamburger-btn">
    <li><a href={`/${locale}/`} class="pixel-item" role="menuitem">{navDict.home || "Home"}</a></li>
    <li class="pixel-sep"><a href={`/${locale}/about/`} class="pixel-item" role="menuitem">{navDict.about || "About"}</a></li>
    <li class="pixel-sep"><a href={`/${locale}/privacy-policy/`} class="pixel-item" role="menuitem">{navDict.privacy || "Privacy Policy"}</a></li>
    <li class="pixel-sep"><a href={`/${locale}/terms-of-service/`} class="pixel-item" role="menuitem">{navDict.terms || "Terms of Service"}</a></li>
  </ul>
</nav>

<script is:inline>
  const hamburgerBtn = document.getElementById('hamburger-btn');
  const navDropdown = document.getElementById('nav-dropdown');

  function openMenu() {
    navDropdown.classList.remove('hidden');
    setTimeout(() => {
      navDropdown.classList.remove('opacity-0', 'scale-95');
      navDropdown.classList.add('opacity-100', 'scale-100');
    }, 10);
    hamburgerBtn.setAttribute('aria-expanded', 'true');
  }

  function closeMenu() {
    navDropdown.classList.add('opacity-0', 'scale-95');
    setTimeout(() => navDropdown.classList.add('hidden'), 200);
    hamburgerBtn.setAttribute('aria-expanded', 'false');
  }

  hamburgerBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // empÃªcher fermeture instantanÃ©e
    const isHidden = navDropdown.classList.contains('hidden');
    if (isHidden) openMenu();
    else closeMenu();
  });

  // ðŸ‘‰ Fermer si on clique ailleurs dans la page
  document.addEventListener('click', (e) => {
    if (!navDropdown.contains(e.target) && !hamburgerBtn.contains(e.target)) {
      if (!navDropdown.classList.contains('hidden')) {
        closeMenu();
      }
    }
  });
</script>

<style>
  body { padding-top: 56px; }

  /* --- Pixel nav theme --- */
  .pixel-nav {
    background: #ffda3e;
    image-rendering: pixelated;
    box-shadow: 0 0 0 4px #2b2b2b inset, 0 6px 0 #2b2b2b;
  }

  .pixel-font { font-family: 'Press Start 2P', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

  .pixel-logo {
    width: 28px; height: 28px; position: relative; display: inline-block;
    background: #2b2b2b;
    box-shadow:
      0 0 0 4px #2b2b2b inset,
      0 0 0 8px #ff3d6e inset,
      0 0 0 12px #ffd93d inset;
  }

  .pixel-button {
    width: 40px; height: 32px; display: grid; place-items: center; background: #ffd93d; color: #2b2b2b;
    box-shadow: 0 0 0 3px #2b2b2b inset, 0 3px 0 #2b2b2b; border: none; cursor: pointer;
  }
  .pixel-button:active { transform: translateY(1px); box-shadow: 0 0 0 3px #2b2b2b inset, 0 2px 0 #2b2b2b; }

  .pixel-bars { position: relative; width: 18px; height: 2px; background: #2b2b2b; display: inline-block; }
  .pixel-bars::before, .pixel-bars::after { content: ""; position: absolute; left: 0; width: 18px; height: 2px; background: #2b2b2b; }
  .pixel-bars::before { top: -6px; }
  .pixel-bars::after { top: 6px; }

  .pixel-card {
    background: #fffef4;
    border: 0; box-shadow: 0 0 0 3px #2b2b2b inset, 0 6px 0 #2b2b2b;
    padding: 6px;
  }
  .pixel-item { display: block; padding: 10px 12px; color: #2b2b2b; text-decoration: none; }
  .pixel-item:hover { background: #ffd93d; }
  .pixel-sep { border-top: 2px solid #2b2b2b22; }

  .drop-shadow-pixel { filter: drop-shadow(2px 0 0 #2b2b2b) drop-shadow(-2px 0 0 #2b2b2b) drop-shadow(0 2px 0 #2b2b2b) drop-shadow(0 -2px 0 #2b2b2b); }

  /* Logo scales visually without changing nav height */
  .logo-wrap { width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; overflow: visible; }
  .logo-img { width: 28px; height: 28px; transform: scale(1.6); transform-origin: center; image-rendering: pixelated; }
</style>
